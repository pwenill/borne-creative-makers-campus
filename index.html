<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- V1.0.1 -->
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, user-scalable=no"
    />

    <!-- Bootstrap CSS -->
    <link href="./bootstrap/bootstrap.min.css" rel="stylesheet" />
    <script src="./jquery-3.7.1.min.js"></script>

    <link rel="stylesheet" href="./keyboard.css" />
    <link rel="stylesheet" href="./style.css" />

    <title>Creative Media Campus</title>
  </head>
  <body>
    <section id="screen">

      <div class="container-fluid h-100">
        <div class="row justify-content-center h-100">
          <div class="col-12 p-0">
            <div id="step-one" class="screen-container-step">
              <img
                src="./assets/logo.png"
                class="logo"
                style="display: none"
                alt=""
              />
              <img src="./assets/background_1.png" class="background-1" />
              <img src="./assets/outline.png" class="outline" />
              <img
                src="./assets/decors.png"
                class="effects"
                alt=""
                style="z-index: 99999; pointer-events: none"
              />
              <div class="card-creative text-center" step-identity="1">
                <div
                  class="step-content align-items-center h-100 justify-content-center"
                  style="display: flex"
                >
                  <img
                    src="./assets/page1/card.png"
                    style="width: 85%"
                    id="start"
                  />
                </div>

                <div class="step-content h-100 flex-column">
                  <div class="step-title">
                    <img src="./assets/page2/text.png" class="w-100" alt="" />
                  </div>

                  <div class="card-formation formationType" style="margin-top: 9rem;">
                    <img
                      src="./assets/page2/card.png"
                      class="card-background"
                      alt=""
                    />
                    <div
                      class="row align-items-center h-100 justify-content-center row-cols-2"
                      style="z-index: 55;"
                    >
                      <div class="col">
                        <img
                          src="./assets/page2/webdesigner.png"
                          class="isdqA80ds"
                          data-switch-page="formation"
                          data-switch-id="Webdesigner"
                        />
                      </div>
                      <div class="col">
                        <img
                          src="./assets/page2/infographie.png"
                          class="isdqA80ds"
                          data-switch-page="formation"
                          data-switch-id="Infographie"
                        />
                      </div>

                      <div class="col">
                        <img
                          src="./assets/page2/realisateur.png"
                          class="isdqA80ds"
                          data-switch-page="formation"
                          data-switch-id="Réalisateur"
                        />
                      </div>
                      <div class="col">
                        <img
                          src="./assets/page2/assistant_prod.png"
                          class="isdqA80ds"
                          data-switch-page="formation"
                          data-switch-id="Assistant Production"
                        />
                      </div>

                      <div class="col">
                        <img
                          src="./assets/page2/monteur-video.png"
                          class="isdqA80ds"
                          data-switch-page="formation"
                          data-switch-id="Monteur Vidéo"
                        />
                      </div>
                    </div>
                  </div>
                </div>

                <div class="step-content flex-column h-100">
                  <div class="return-box">
                    <button class="return" id="return">Retour</button>
                  </div>
                  <div class="step-title">
                    <img src="./assets/page3/text.png" class="w-100" alt="" />
                  </div>

                  <div class="card-formation formationCenter">
                    <div
                      class="row h-100 text-center align-items-center justify-content-center"
                    >
                      <div class="col-12">
                        <div class="row">
                          <div class="col">
                            <img
                              src="./assets/page3/steclotilde.png"
                              alt=""
                              data-switch-page="centre"
                              data-switch-id="Sainte-Clotilde"
                              class="s51A91dz"
                            />
                          </div>
                          <div class="col">
                            <img
                              src="./assets/page3/piton.png"
                              alt=""
                              data-switch-page="centre"
                              data-switch-id="Piton Saint-Leu"
                              class="s51A91dz"
                            />
                          </div>
                          <div class="col-12 text-center">
                            <img
                              src="./assets/page3/marseille.png"
                              alt=""
                              data-switch-page="centre"
                              data-switch-id="Marseille"
                              class="s51A91dz"
                              style="width: 60%; margin-top: 90px"
                            />
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="step-content flex-column h-100">
                  <div class="return-box">
                    <button class="return" id="return">Retour</button>
                  </div>
                  <div class="step-title">
                    <img src="./assets/page4/text.png" class="w-100" alt="" />
                  </div>

                  <div class="card-formation formulaire">
                    <form action="" onsubmit="return false;">
                      <img src="./assets/page4/card.png" alt="" />
                      <div style="padding: 20px 0px">
                        <input
                          type="text"
                          class="form-control input-form focus"
                          name="lastname"
                          placeholder="Nom"
                          autocomplete="off"
                        />
                        <input
                          type="text"
                          class="form-control input-form"
                          name="firstname"
                          placeholder="Prénom"
                          autocomplete="off"
                        />
                        <input
                          type="text"
                          class="form-control input-form"
                          name="age"
                          placeholder="Age"
                          autocomplete="off"
                        />
                        <input
                          type="text"
                          name="phone"
                          class="form-control input-form"
                          placeholder="Telephone"
                          autocomplete="off"
                        />
                        <input
                          type="text"
                          class="form-control input-form"
                          name="email"
                          placeholder="Email"
                          autocomplete="off"
                        />
                      </div>
                    </form>
                  </div>
                  <div id="keyboard">
                    <div class="simple-keyboard"></div>
                  </div>
                  <div class="card-formation" style="margin-top: 0">
                    <div style="width: 100%; margin: 0 auto; margin-top: 30px">
                      <img
                        src="./assets/page4/button.png"
                        class="w-100"
                        id="submit"
                      />
                    </div>
                  </div>
                </div>

                <div
                  class="step-content align-items-center h-100 justify-content-center"
                >
                  <img
                    src="./assets/final-card.png"
                    style="width: 85%"
                    id="restart"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <script src="./bootstrap/bootstrap.bundle.min.js"></script>
    <script src="./bootstrap/popper.min.js"></script>
    <script src="./bootstrap/bootstrap.min.js"></script>

    <script src="./simple-keyboard/index.min.js"></script>
    <script src="./simple-keyboard/keyboard-layout.js"></script>
    <script src="./keyboard.js"></script>

    <script>
      let currentTabForms = {};
      let currentTab = 0;
      let latestTab = 0;
      let currentTimeout = null;
      let timeoutTab = null;

      $(document).ready(() => {
        $('.loading').fadeOut(100)
        setInterval(() => {
          console.log("o")
        }, 1000)
      });

      $(document).on('click', 'button, [data-switch-page]', () => {
        $('.loading').fadeIn(100)
      })

      $(document).on("click", "#start", (e) => {
        if (currentTimeout) clearTimeout(currentTimeout);

        clearInput();
        document.querySelector(`form`).reset();

        currentTab++;
        currentTabForms = {};
        showTab(currentTab);
      });

      $(document).on("click", "#restart", (e) => {
        if (currentTimeout) clearTimeout(currentTimeout);

        latestTab = 0;
        currentTab = 0;
        showTab(currentTab);
      });

      $(document).on("click", "[data-switch-page]", (e) => {
        const page = $(e.target).attr("data-switch-page");
        const value = $(e.target).attr("data-switch-id");

        latestTab = currentTab;
        currentTab++;
        currentTabForms[page] = value;
        showTab(currentTab);
      });

      $(document).on("click", "#submit", (e) => {
        let currentStorage = JSON.parse(localStorage.getItem("clients"));
        if (!currentStorage) currentStorage = [];

        let lastname = $('[name="lastname"]').val();
        let firstname = $('[name="firstname"]').val();
        let email = $('[name="email"]').val();
        let phone = $('[name="phone"]').val();
        let age = $('[name="age"]').val();

        let soqANid = currentTabForms;

        if (
          lastname.length == 0 ||
          firstname.length == 0 ||
          email.length == 0 ||
          phone.length == 0 ||
          age.length == 0
        )
          return;

        if (!validateEmail(email)) return;

        currentStorage.push({
          id: Math.floor(Math.random() * 999999),
          formation: soqANid.formations ? soqANid.formations : undefined,
          centre: soqANid.centre ? soqANid.centre : undefined,
          lastname,
          firstname,
          email,
          phone,
          age,
        });

        localStorage.setItem("clients", JSON.stringify(currentStorage));

        latestTab = currentTab;
        currentTab++;
        showTab(currentTab);

        document.querySelector(`form`).reset();

        currentTimeout = setTimeout(() => {
          latestTab = 0;
          currentTab = 0;
          currentTabForms = {};
          showTab(currentTab);
        }, 10000);
      });

      $(document).on("click", "#return", (e) => {
        latestTab = currentTab;
        if (currentTab - 1 == 0) return;
        currentTab--;
        showTab(currentTab);
      });

      document.addEventListener(
        "contextmenu",
        function (e) {
          e.preventDefault();
        },
        false
      );

      document.addEventListener(
        "fullscreenchange",
        function () {
          if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen();
          }
        },
        false
      );

      // Désactiver le pincement pour zoomer
      document.addEventListener(
        "touchstart",
        function (event) {
          if (event.touches.length > 1) {
            event.preventDefault(); // Empêche le geste de pincement
          }
        },
        { passive: false }
      );

      // Désactiver le double-tap pour zoomer
      let lastTouchEnd = 0;
      document.addEventListener(
        "touchend",
        function (event) {
          const now = new Date().getTime();
          if (now - lastTouchEnd <= 300) {
            event.preventDefault(); // Empêche le double-tap
          }
          lastTouchEnd = now;
        },
        false
      );

      const showTab = (i) => {
        $('.loading').fadeOut(100)
        let time = 200;

        if (i == 0 || i == 4) {
          $(".logo").css("display", "none");
        } else {
          $(".logo").css("display", "block");
        }

        if (timeoutTab) clearTimeout(timeoutTab);

        document.querySelectorAll(`.step-content`).forEach((e, index) => {
          $(e).fadeOut(time);
          if (index == i) {
            //e.style.display = "flex";
            timeoutTab = setTimeout(() => {
              console.log("ok3");
              $(e).css("display", "flex").hide().fadeIn(time);
            }, time);
          } else {
            //e.style.display = "none";
          }
        });
      };

      function validateEmail(email) {
        var regex =
          /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return regex.test(email);
      }
    </script>
  </body>
</html>
